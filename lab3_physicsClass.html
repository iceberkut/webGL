<!DOCTYPE html>
<html lang="ru">
<head>
    <title>three.js — Куб с физическими темами</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link type="text/css" rel="stylesheet" href="https://threejs.org/examples/main.css">
</head>
<body>
<div id="info">Трёхмерный куб по физике</div>

<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

<script type="importmap">
    {
      "imports": {
        "three": "https://threejs.org/build/three.module.js",
        "three/addons/": "https://threejs.org/examples/jsm/"
      }
    }
</script>

<script type="module">

    import * as THREE from 'three';
    import {OrbitControls} from 'three/addons/controls/OrbitControls.js';
    import {GLTFLoader} from 'three/addons/loaders/GLTFLoader.js';

    let camera, scene, renderer, controls;

    init();
    animate();

    const loader = new GLTFLoader();
    loader.load(
        'https://iceberkut.github.io/webGL/low_poly_girl.glb',
        function (gltf) {
            const model = gltf.scene;

            function findBones(object) {
                const bones = [];
                object.traverse((child) => {
                    if (child.isBone) {
                        bones.push(child);
                    }
                });
                return bones;
            }

            const bones = findBones(model);
            console.log('Bones found:', bones);

            setTimeout(() => {
                bones.forEach(bone => {
                    if (bone.name.toLowerCase().includes('arm') ||
                        bone.name.toLowerCase().includes('hand')) {
                        bone.rotation.x = Math.PI / 4; // 45 градусов
                    }

                    if (bone.name.toLowerCase().includes('leg') ||
                        bone.name.toLowerCase().includes('foot')) {
                        bone.rotation.z = -Math.PI / 35; // -30 градусов
                    }
                });
            }, 0);

            model.traverse((child) => {
                if (child.isMesh) {
                    if (child.material) {
                        child.material.transparent = false;
                        child.material.opacity = 1.0;
                        child.material.depthWrite = true;
                        child.material.alphaTest = 0.5;
                    }
                }

            });
            model.scale.set(1200, 1200, 1200);
            model.position.set(-500, -3200, -1200);
            scene.add(model);
        },
        function (xhr) {
            console.log((xhr.loaded / xhr.total * 100) + '% загружено');
        },
        function (error) {
            console.error('Ошибка загрузки модели:', error);
        }
    );

    function init() {

        const container = document.createElement('div');
        document.body.appendChild(container);

        // Камера
        camera = new THREE.PerspectiveCamera(65, window.innerWidth / window.innerHeight, 1, 80000);
        camera.position.set(0, -500, 2900);

        // Свет
        const ambientLight = new THREE.AmbientLight(0x333333, 50);
        const light = new THREE.DirectionalLight(0xffffff, 1.0);
        light.position.set(1, 1, 1);

        // Рендер
        renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        // Сцена
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xd3d3d3);
        scene.add(ambientLight);
        scene.add(light);

        // Контроллер
        controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.enableZoom = true;
        controls.zoomSpeed = 0.5;
        controls.minDistance = 500;
        controls.maxDistance = 5000;
        controls.target.set(50, 0, 50);

        const textureLoader = new THREE.TextureLoader();
        const urls = [
            'https://iceberkut.github.io/webGL/1.jpg',
            'https://iceberkut.github.io/webGL/2.jpg',
            'https://iceberkut.github.io/webGL/3.jpg',
            'https://iceberkut.github.io/webGL/4.jpg',
            'https://iceberkut.github.io/webGL/5.jpg',
            'https://iceberkut.github.io/webGL/6.jpg'
        ];

        const materials = urls.map(url => {
            const texture = textureLoader.load(url);
            texture.wrapS = THREE.RepeatWrapping;
            texture.repeat.x = 1;
            return new THREE.MeshPhongMaterial({map: texture, side: THREE.BackSide});
        });

        const geometry = new THREE.BoxGeometry(5000, 5000, 5000);
        const cube = new THREE.Mesh(geometry, materials);
        cube.position.y = 100;
        scene.add(cube);

        window.addEventListener('resize', onWindowResize);
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
    }

</script>

</body>
</html>
